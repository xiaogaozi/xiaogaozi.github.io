<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">如何设计与实现一个分布式索引框架（五）：分布式 | Freedom</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://xiaogaozi.org/blog/2020/05/25/how-to-design-a-distributed-index-framework-part-5"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="如何设计与实现一个分布式索引框架（五）：分布式 | Freedom"><meta data-rh="true" name="description" content="这是一个系列文章，大部分内容都来自我过去在小红书发现 Feed 团队工作期间的实践和经验。在介绍的过程中我会尽量不掺杂过多的业务细节，而专注于这背后我个人一些浅薄的设计思想，希望你在阅读完这些文章以后能够直接或者间接地拓展到不同的场景。"><meta data-rh="true" property="og:description" content="这是一个系列文章，大部分内容都来自我过去在小红书发现 Feed 团队工作期间的实践和经验。在介绍的过程中我会尽量不掺杂过多的业务细节，而专注于这背后我个人一些浅薄的设计思想，希望你在阅读完这些文章以后能够直接或者间接地拓展到不同的场景。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-05-25T11:21:49.000Z"><meta data-rh="true" property="article:tag" content="index,distrubted,htdadif,recommendation,machine learning"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiaogaozi.org/blog/2020/05/25/how-to-design-a-distributed-index-framework-part-5"><link data-rh="true" rel="alternate" href="https://xiaogaozi.org/blog/2020/05/25/how-to-design-a-distributed-index-framework-part-5" hreflang="en"><link data-rh="true" rel="alternate" href="https://xiaogaozi.org/blog/2020/05/25/how-to-design-a-distributed-index-framework-part-5" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Freedom - Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Freedom - Blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Freedom - Blog JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VLS34Q8L74"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-VLS34Q8L74",{})</script><link rel="stylesheet" href="/assets/css/styles.fd1ab797.css">
<link rel="preload" href="/assets/js/runtime~main.0ebb8d5b.js" as="script">
<link rel="preload" href="/assets/js/main.5816cfb0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Freedom</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Podcast</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/podcast/tags/no-admittance">立入禁止</a></li></ul></div><a class="navbar__item navbar__link" href="/projects">Projects</a><a class="navbar__item navbar__link" href="/about">About</a><a href="https://maybe.news" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Maybe News<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_brwN thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_r4Q1 margin-bottom--md">Recent posts</div><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2024/01/09/my-annual-movie-and-tv-roundup-for-2023">我的 2023 年年度影视盘点</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2023/03/11/large-scale-distributed-file-system-comparison">浅析三款大规模分布式文件系统架构设计</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/08/14/introduction-to-recommendation-system">推荐系统：从入门到放弃</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/08/12/maybe-news-series-dail-up-1">Maybe News Series - 连接：互联网简史 #1 Paul Baran</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/2022/08/08/maybe-news-series-dail-up-0">Maybe News Series - 连接：互联网简史 #0 Intro</a></li></ul><div class="sidebarItemTitle_r4Q1 margin-bottom--md"><a class="sidebarItemLink_yNGZ" href="/blog/archive">Archive</a></div><div><div class="sidebarItemTitle_r4Q1 margin-bottom--md">Feed</div><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a href="/blog/atom.xml" class="sidebarItemLink_yNGZ">Atom</a></li><li class="sidebarItem_lnhn"><a href="/blog/rss.xml" class="sidebarItemLink_yNGZ">RSS</a></li><li class="sidebarItem_lnhn"><a href="/blog/feed.json" class="sidebarItemLink_yNGZ">JSON</a></li></ul></div></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">如何设计与实现一个分布式索引框架（五）：分布式</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-05-25T11:21:49.000Z" itemprop="datePublished">May 25, 2020</time> · <!-- -->16 min read</div></header><div id="post-content" class="markdown" itemprop="articleBody"><blockquote><p>这是一个<a href="/blog/tags/htdadif">系列文章</a>，大部分内容都来自我过去在小红书发现 Feed 团队工作期间的实践和经验。在介绍的过程中我会尽量不掺杂过多的业务细节，而专注于这背后我个人一些浅薄的设计思想，希望你在阅读完这些文章以后能够直接或者间接地拓展到不同的场景。</p></blockquote><p>前面几篇文章介绍的技术都是在单机上实现的，但如果做不到分布式那整个系统的扩展性将会受到非常大的限制。本篇文章将会围绕分布式这个话题讨论。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据分割partition">数据分割（Partition）<a href="#数据分割partition" class="hash-link" aria-label="Direct link to 数据分割（Partition）" title="Direct link to 数据分割（Partition）">​</a></h2><p>分布式存储很大一个目的是为了将数据分布到多个节点上，以突破单机的存储限制，实现水平扩展（horizontal scaling）。因此这就涉及到一个很重要的问题：要如何将数据分布到不同的节点上？可能的几种做法有：</p><ol><li>随机：每一条数据都随机分配到某个节点上</li><li>轮询（round-robin）：通过轮询的方式将数据分配到节点上，例如第 1 条数据分配到节点 1，第 2 条数据就分配到节点 2，以此类推。</li><li>哈希（hash）：通过某种哈希算法将数据中的某个 key 映射到一个固定的值，根据这个值来分配节点。</li><li>范围（range）：划定一些范围，并将这些范围与节点进行映射，当数据中的某个 key 属于某个范围时就分配到对应的节点上。</li></ol><p>方案 1 显然是最简单的，但也是最不可行的。这个方案有两个大问题：因为数据是随机分配的，因此在查询某一条数据时必须请求所有节点；同样因为随机分配的关系，不同节点之间的数据量可能是非常不均衡的。</p><p>方案 2 相比方案 1 稍微改进了一点，轮询的方式可以基本保证数据分布是均衡的，但是在查询时还是必须请求所有节点。</p><p>方案 3 基本解决了前面提到的两个问题，哈希算法通常是稳定的，也就是说通过某个 key 得到的哈希值是固定的。比如最简单的哈希算法取模运算，将 key 模上集群的节点数 <code>key mod N</code>，就可以算出这个 key 应该分配的节点。不过取模运算虽然简单但也存在一些问题，最明显的就是当添加新节点或者删除老节点的时候会造成大量的数据重新分配（rebalance）。因此比较常见的改进方案是采用<a href="https://en.wikipedia.org/wiki/Consistent_hashing" target="_blank" rel="noopener noreferrer">一致性哈希</a>（consistent hashing），一致性哈希可以显著降低数据重新分配这个过程需要迁移的数据量。Amazon 的 <a href="https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf" target="_blank" rel="noopener noreferrer">Dynamo</a> 便是采用一致性哈希进行数据分割的一个很好的例子，Cassandra 的<a href="https://cassandra.apache.org/doc/latest/architecture/dynamo.html" target="_blank" rel="noopener noreferrer">官方文档</a>里也介绍了类似的内容。但是一致性哈希也不是没有缺点，当集群节点数较少时还是有可能造成数据分布不均衡，因此 Dynamo 提出了通过增加虚拟节点（virtual node）的方法来解决这个问题，细节可以参考论文或者 Cassandra 的文档。</p><p>方案 4 也能实现稳定查询，例如将数据 key 的首字母限定在 a-z 这 26 个字母中，再将 a-z 等分为几个范围（range），那么就能根据 key 的首字母确定属于哪个范围。同时每个节点会包含 1 个或多个范围，便能将 key 分配到某个节点上。HBase 便是采用范围分割数据的一个案例，但是由于 HBase 不会预先为所有节点绑定范围，因此在实践中通常还要结合 <a href="https://hbase.apache.org/book.html#tricks.pre-split" target="_blank" rel="noopener noreferrer">pre-split</a> 来避免数据都集中在少数节点中。因为每个范围都是连续的，所以方案 4 相比方案 3 的一个优势是对于范围扫描（range scan）的支持更好。</p><p>综合来看方案 3 和方案 4 都是可行的方案，它们也都有各自的一些优缺点，如何选择还得看具体的使用场景。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据复制replication">数据复制（Replication）<a href="#数据复制replication" class="hash-link" aria-label="Direct link to 数据复制（Replication）" title="Direct link to 数据复制（Replication）">​</a></h2><p>数据分布到多个节点上以后，虽然扩展性（scalability）得到了满足，但是随着节点数的增多，可用性（availability）的重要性会逐渐凸显出来。节点因为各种原因下线是非常普遍的，一旦节点下线那这台节点上的数据将无法访问。因此为了保障可用性，通常会通过冗余存储的方式来解决，也就是为每一份数据新增多个副本（replica），然后将副本分散到不同的节点上，只要还有至少 1 个副本存在那即使部分节点下线也能继续访问数据。为了实现多副本也有几种可能的方案：</p><ol><li>节点组（node group）：为每个节点创建多个副本节点，这些节点共同组成一个节点组。一个节点组内部的数据是完全相同的，不同节点组之间的数据是不同的。</li><li>混合（hybrid）：每个节点不仅有属于自己的数据，同时还存储了其它节点数据的副本。</li></ol><p>方案 1 中节点组之间的数据因为是相互独立的，因此实现和维护相对来说都会比较简单，新增副本就只需要在每个节点组中新增节点即可。我们在数据库系统中经常见到主（master）从（slave）节点的概念，这里可以把 1 个主节点和多个从节点看作是一个节点组。</p><p>方案 2 是目前主流分布式存储的实现方案，在存储数据时通过某种算法选择多个副本节点，并时刻检查当前数据的副本数是否符合用户设定的值。这种方案因为在一个节点上同时包含了原始数据和副本，相比方案 1 节点的资源利用率会更高，但代价就是维护成本会有所提升。</p><p>不论是选择前面介绍的哪种方案都会涉及到一个问题：如何将原始数据同步到副本上？这里就必须提及在分布式系统中非常重要的一个概念「一致性（consistency）」<sup id="fnref-1-ef81ca"><a href="#fn-1-ef81ca" class="footnote-ref">1</a></sup>，所谓一致性就是用于描述分布式系统中不同实体间状态（state）一致程度的概念。一致性从强到弱大致可以分为以下 4 种类别：</p><ol><li>线性一致性（Linearizability）或者强一致性（Strong consistency）</li><li>顺序一致性（Sequential consistency）</li><li>因果一致性（Causal consistency）</li><li>最终一致性（Eventual consistency）</li></ol><p>一致性越强的算法对数据的一致要求也越高，当然实现成本也越高。线性一致性的代表有 <a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)" target="_blank" rel="noopener noreferrer">Paxos</a> 和 <a href="https://raft.github.io" target="_blank" rel="noopener noreferrer">Raft</a>，最终一致性的代表有 Dynamo<sup id="fnref-2-ef81ca"><a href="#fn-2-ef81ca" class="footnote-ref">2</a></sup>。为什么一致性如此重要呢？因为分布式系统天然存在的并发和延迟，要如何把一个集群的状态更新最终实现得看起来就像一台单机一样，这是一致性算法要解决的问题。</p><p>具体细分状态复制的实现方式有两种：一种是传统的 replicated state machine（或者叫做 active replication），另一种是 primary-backup（或者叫做 primary-copy、passive replication）。前者的代表有 Paxos 和 Raft，后者的代表有 <a href="http://www.cs.princeton.edu/courses/archive/fall09/cos518/papers/viewstamped.pdf" target="_blank" rel="noopener noreferrer">Viewstamped Replication</a> 和 <a href="https://marcoserafini.github.io/papers/zab.pdf" target="_blank" rel="noopener noreferrer">Zab（ZooKeeper Atomic Broadcast）</a>。有关这两种状态复制方案的区别可以看看 Raft 作者的<a href="https://web.stanford.edu/~ouster/cgi-bin/papers/OngaroPhD.pdf" target="_blank" rel="noopener noreferrer">博士毕业论文</a><sup id="fnref-3-ef81ca"><a href="#fn-3-ef81ca" class="footnote-ref">3</a></sup>和 <a href="https://arxiv.org/abs/1309.5671" target="_blank" rel="noopener noreferrer">Vive la Différence: Paxos vs. Viewstamped Replication vs. Zab</a> 这篇论文。</p><p>因此回到最开始的那个问题「要如何将原始数据同步到副本」，这取决于你需要哪种程度的一致性，你甚至可以说我不需要一致性<sup id="fnref-4-ef81ca"><a href="#fn-4-ef81ca" class="footnote-ref">4</a></sup>。对于推荐系统的场景，线性一致性属于杀鸡用牛刀<sup id="fnref-5-ef81ca"><a href="#fn-5-ef81ca" class="footnote-ref">5</a></sup>，所以我们只要追求最终一致性就够了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="集群成员管理">集群成员管理<a href="#集群成员管理" class="hash-link" aria-label="Direct link to 集群成员管理" title="Direct link to 集群成员管理">​</a></h2><p>一个分布式系统必然是由多个节点构成的，那这些节点之间要如何互相感知呢？关于这个问题可以分为两类方案：中心化和去中心化。</p><p>所谓中心化就是存在一个（或一组）集中管理的服务，这个中心服务负责接收并存储集群所有节点上报的信息，以及反向分发这些信息，相当于一个集群的信息枢纽。在微服务领域有另外一个词用于表示类似的功能：服务注册与发现。常见的可以实现这种中心服务的开源组件有 <a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">ZooKeeper</a>、<a href="https://etcd.io" target="_blank" rel="noopener noreferrer">etcd</a> 和 <a href="https://www.consul.io" target="_blank" rel="noopener noreferrer">Consul</a>。</p><p>而去中心化顾名思义就是不存在一个中心服务，完全依靠集群内各个节点之间的通信来实现拓扑发现。最著名的去中心化协议恐怕就是 <a href="https://en.wikipedia.org/wiki/Gossip_protocol" target="_blank" rel="noopener noreferrer">gossip 协议</a>，这是一个可以实现点对点（P2P）通信的协议，很多开源系统里也使用到了 gossip，比如 <a href="https://cassandra.apache.org/doc/latest/architecture/dynamo.html#distributed-cluster-membership-and-failure-detection" target="_blank" rel="noopener noreferrer">Cassandra</a> 和 <a href="https://www.consul.io/docs/internals/gossip.html" target="_blank" rel="noopener noreferrer">Consul</a>。</p><p>至于是中心化还是去中心化好那只能是见仁见智了，没有哪个方案是绝对完美的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据重新分配rebalance">数据重新分配（Rebalance）<a href="#数据重新分配rebalance" class="hash-link" aria-label="Direct link to 数据重新分配（Rebalance）" title="Direct link to 数据重新分配（Rebalance）">​</a></h2><p>前面的「数据分割」小节已经介绍了如何将数据分布到不同的节点上，如果一个集群的节点数永远不变那这不会带来任何问题，但是如果存在新增或者删除节点的情况呢？不论是哈希还是范围分割的方法，都必须要重新分配数据，以保持集群节点间的数据均衡。为了不影响已有的节点，数据重新分配通常的实现都是在一个后台线程中执行，同时也要控制数据同步的带宽和速率。当数据重新分配这个过程完成以后就可以上线或者下线对应的节点。</p><p>当然数据重新分配也不一定就只是由集群节点伸缩触发的，某些系统也会实时地根据当前每个节点的负载而动态调整数据的分布，目的是为了避免出现热点导致整体系统的稳定性受影响。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="整体设计">整体设计<a href="#整体设计" class="hash-link" aria-label="Direct link to 整体设计" title="Direct link to 整体设计">​</a></h2><p>综合前面介绍的所有内容，现在如果让你来设计分布式索引你会如何设计？这里提供一个我们的实现方案，但是请记住一定不存在一个完美的方案，任何架构设计都是权衡（trade-off）的结果。</p><p><img loading="lazy" alt="recommendation system distributed design" src="/assets/images/rec_sys_distributed_design-2e47ac85b5c5569d8acc343a8c652c27.png" width="1992" height="722" class="img_ev3q"></p><p>简单总结上面这个方案的一些特点：</p><ul><li>通过哈希来进行数据分割</li><li>通过节点组的方式进行数据复制，一致性的要求是最终一致性<sup id="fnref-6-ef81ca"><a href="#fn-6-ef81ca" class="footnote-ref">6</a></sup>。</li><li>通过 Consul 来进行服务注册和发现，并封装一个库供客户端使用。</li></ul><p>以上就是关于分布式的介绍，下一篇文章的内容会相对轻松一些，聊一聊所谓的端到端（end-to-end）用户体验。</p><div class="footnotes"><hr><ol><li id="fn-1-ef81ca">如果想系统了解一致性，推荐阅读 Jepsen 的<a href="https://jepsen.io/consistency" target="_blank" rel="noopener noreferrer">系列文档</a>、普林斯顿大学的 <a href="https://www.cs.princeton.edu/courses/archive/fall19/cos418" target="_blank" rel="noopener noreferrer">COS 418</a> 课程以及 The Morning Paper 的<a href="https://blog.acolyer.org/2015/03/01/cant-we-all-just-agree" target="_blank" rel="noopener noreferrer">系列解读</a>。<a href="#fnref-1-ef81ca" class="footnote-backref">↩</a></li><li id="fn-2-ef81ca">Amazon 的 CTO 也写过<a href="https://www.allthingsdistributed.com/2008/12/eventually_consistent.html" target="_blank" rel="noopener noreferrer">一篇博客</a>讲解最终一致性<a href="#fnref-2-ef81ca" class="footnote-backref">↩</a></li><li id="fn-3-ef81ca">具体位置在「11.6 Replicated state machines vs. primary copy approach」章节<a href="#fnref-3-ef81ca" class="footnote-backref">↩</a></li><li id="fn-4-ef81ca">那你爱咋同步咋同步<a href="#fnref-4-ef81ca" class="footnote-backref">↩</a></li><li id="fn-5-ef81ca">用户根本不关心（或者说根本察觉不出）不同推荐结果之间有什么一致性问题<a href="#fnref-5-ef81ca" class="footnote-backref">↩</a></li><li id="fn-6-ef81ca">实践中我们是通过 HDFS 作为索引数据源，每个节点自行拉取（pull）的方式实现。<a href="#fnref-6-ef81ca" class="footnote-backref">↩</a></li></ol></div></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/index">index</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/distrubted">distrubted</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/htdadif">htdadif</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/recommendation">recommendation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/machine-learning">machine learning</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2020/06/02/maybe-news-issue-2"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Maybe News Issue #2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2020/05/21/maybe-news-issue-1"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Maybe News Issue #1</div></a></nav><div class="commentContainer_NL3Q"><div id="disqus_thread"></div></div></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#数据分割partition" class="table-of-contents__link toc-highlight">数据分割（Partition）</a></li><li><a href="#数据复制replication" class="table-of-contents__link toc-highlight">数据复制（Replication）</a></li><li><a href="#集群成员管理" class="table-of-contents__link toc-highlight">集群成员管理</a></li><li><a href="#数据重新分配rebalance" class="table-of-contents__link toc-highlight">数据重新分配（Rebalance）</a></li><li><a href="#整体设计" class="table-of-contents__link toc-highlight">整体设计</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 xiaogaozi. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0ebb8d5b.js"></script>
<script src="/assets/js/main.5816cfb0.js"></script>
</body>
</html>